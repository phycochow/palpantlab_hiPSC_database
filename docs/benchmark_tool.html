<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<!-- ############## -->
<!-- Header Content -->
<!-- ############## -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="generator" content="pandoc"/>

    <title>Latest hiPSC-CM Protocols</title>
    <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
    <script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
    <script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
    <script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
    <script src="site_libs/navigation-1.1/tabsets.js"></script>
    <script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>

    <link href="site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
    <script src="site_libs/datatables-binding-0.24/datatables.js"></script>
    <link href="site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
    <link href="site_libs/dt-ext-buttons-1.11.3/css/buttons.dataTables.min.css" rel="stylesheet" />
    <script src="site_libs/dt-ext-buttons-1.11.3/js/dataTables.buttons.min.js"></script>
    <script src="site_libs/dt-ext-buttons-1.11.3/js/buttons.html5.min.js"></script>
    <script src="site_libs/dt-ext-buttons-1.11.3/js/buttons.colVis.min.js"></script>
    <script src="site_libs/dt-ext-buttons-1.11.3/js/buttons.print.min.js"></script>
    <link href="site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
    <script src="site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>

    <!-- Favicons for Apple and Windows users -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="icon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="icon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="icon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="icon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="icon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="icon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="icon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="icon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="icon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="icon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="icon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="icon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="icon/favicon-128.png" sizes="128x128" />

    <meta name="application-name" content="&nbsp;"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="icon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="icon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="icon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="icon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="icon/mstile-310x310.png" />

    <style type="text/css">
        h1 {
            font-size: 34px;
        }

        h1.title {
            font-size: 38px;
        }

        h2 {
            font-size: 30px;
        }

        h3 {
            font-size: 24px;
        }

        h4 {
            font-size: 18px;
        }

        h5 {
            font-size: 16px;
        }

        h6 {
            font-size: 12px;
        }

        .table th:not([align]) {
            text-align: left;
        }

    </style>
        
    <link rel="stylesheet" href="choco.css" type="text/css"/>
    <link rel="stylesheet" href="dt_style.css" type="text/css"/>
</head>

<!-- ############ -->
<!-- Body content -->
<!-- ############ -->
<body>

    <style type="text/css">
        .main-container {
            max-width: 940px;
            margin-left: auto;
            margin-right: auto;
        }

        code {
            color: inherit;
            background-color: rgba(0, 0, 0, 0.04);
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .tabbed-pane {
            padding-top: 12px;
        }

        button.code-folding-btn:focus {
            outline: none;
        }
    </style>

    <style type="text/css">
        /* Padding for bootstrap navbar */
        body {
            padding-top: 51px;
            padding-bottom: 40px;
        }

        /* Offset scroll position for anchor links (for fixed navbar) */
        .section h1, 
        .section h2, 
        .section h3, 
        .section h4, 
        .section h5, 
        .section h6 {
            padding-top: 56px;
            margin-top: -56px;
        }
    </style>

    <style>
        /* Target the dropdown or modal that appears for the column visibility */
        .dt-button-collection {
            min-width: 450px; /* Set the desired width here */
            white-space: normal; /* Ensure long column names wrap within the width */
        }
    </style>

    <!-- Manages active state of menu based on current page -->
    <script>
        $(document).ready(function () {
            // active menu anchor
            href = window.location.pathname
            href = href.substr(href.lastIndexOf('/') + 1)
            if (href === "")
                href = "index.html";
            var menuAnchor = $('a[href="' + href + '"]');

            // mark it active
            menuAnchor.parent().addClass('active');

            // if it's got a parent navbar menu mark it active as well
            menuAnchor.closest('li.dropdown').addClass('active');
        });
    </script>

    <div class="container-fluid main-container">
        <!-- The backbone of the server. Nagivation bar -->
        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
          <div class="container">

            <!-- Navbar Header: Includes the brand name and the toggle button for collapsing the navbar -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <!-- Brand name -->
              <a class="navbar-brand" href="homepage.html">hiPSC-CM Benchmarking Portal</a>
            </div> <!-- navbar-header -->

            <!-- Navbar links and dropdowns -->
            <div id="navbar" class="navbar-collapse collapse">
              <ul class="nav navbar-nav">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                    Study Database<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="benchmark_tool.html">Comparision Tool</a></li>
                    <li><a href="original_database.html">Source Database</a></li>
                  </ul> <!-- dropdown-menu -->
                </li> <!-- dropdown -->

                <li><a href="result_plots.html">Enriched Variables</a></li>

                <li><a href="methods_overview.html">Methods</a></li>
              </ul> <!-- nav navbar-nav -->

              <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                    About<span class="caret"></span>
                  </a>
                  <ul class="dropdown-menu" role="menu">
                    <li><a href="credits.html">Data & Credits</a></li>
                    <li><a href="https://github.com/phycochow/palpantlab_hiPSC_database" target="_blank">Server Code</a></li>
                    <li><a href="https://imb.uq.edu.au/research-groups/palpant" target="_blank">Palpant Group</a></li>
                  </ul> <!-- dropdown-menu -->
                </li> <!-- dropdown -->
              </ul> <!-- nav navbar-nav navbar-right -->

            </div> <!-- navbar-collapse -->

          </div> <!-- container -->
        </div> <!-- navbar navbar-default navbar-fixed-top-->

        <!-- ################# -->
        <!-- Start of database -->
        <!-- ################# --> 
        <div class="fluid-row" id="header">
            <h3 class="title toc-ignore">Benchmarking Tool: Processed 314 hiPSC-CM Protocol Information</h3>
            <p>QC'ed and Processed from the <a href="original_database.html">Original Database</a>. Install datasets <a href="credits.html">here.</a></p>
            <p>Last Updated: 17th September, 2024</p>
        </div>

        <hr/> <!-- Horizontal line -->

        <!-- Add New Row Form (compact version after the DataTable) -->
        <div class="well">
            <div id="addRowForm" class="mt-3">
                <h3><strong>Search for Similar Studies</strong></h3>
                <p>Select the protocol parameters below. The server will temporarily add your protocol as the <strong>first row in the table</strong>, and the best matches will be shown in subsequent rows.</p>

                <form id="newRowForm" class="form-inline">
                    <!-- Dynamically generated inputs based on the CSV headers -->
                    <div id="formInputs" class="mb-2"></div>
                    <p></p> <!-- Small line break -->
                    <button type="submit" class="btn btn-primary ml-2">Click This and Scroll Down</button>
                </form>
            </div> <!-- addRowForm -->
        </div> <!-- well -->

        <p></p> <!-- Short line break -->

        <div class="well">
            <h3><strong>Results - Known Functional Outcomes</strong></h3>
            <p>Bracketed number refers to the number of published studies with a reported value. Quantiled ranges are shown in the second figure in <a href="result_plots.html" target="_blank">Enriched Variables (new page)</a> by ascending order. Leaving this page will reset the Comparision Tool.</p>
            <p></p> <!-- Small line break -->
            <div id="tsv-data"></div> 
        </div> <!-- well -->

        <script>
            let iterationNumber = 0;
            let tsvData = [];
            let MaxSimilarity = 0; // Initialize MaxSimilarity as a global variable

            async function loadTSV() {
                try {
                    const response = await fetch('https://phycochow.github.io/palpantlab_hiPSC_database/datasets/1_Processed_hiPSC_12Sep24.tsv');
                    const tsvText = await response.text();
                    const rows = tsvText.split('\n').map((row, index) => {
                        const cells = row.split('\t').map(cell => cell === '' ? 'NaN' : cell);
                        if (index === 0) {
                            // Add "Similarity" as the header for the new column
                            cells.push('Similarity');
                        } else {
                            // Add the iteration number as the "Similarity" value for each data row
                            cells.push(index.toString());
                        }
                        return cells;
                    });

                    tsvData = rows;
                    iterationNumber = tsvData.length - 1; // Initialize iterationNumber with the number of data rows

                    constructDataTable(tsvData);
                } catch (error) {
                    console.error('Error loading TSV:', error);
                    document.getElementById('tsv-data').innerHTML = 'Error loading TSV file. See console for details.';
                }
            }

            function generateFormInputs(headers) {
                const sectionDict = {
                    "Key Variables Regarding Differentiation and Maturation": {
                        "hiPSC Line": 19,
                        "Number of hiPSC Lines": 6,
                        "hiPSC Backbone Media": 10,
                        "hiPSC-CM Backbone Media": 8,
                        "Wnt Inhibitor": 11,
                        "Wnt Inhibition Duration": 8,
                        "Induction Conditions": 8,
                        "Induction Duration": 6,
                        "Insulin Addition": 4,
                        "Maturation Strategy": 8,
                        "Metabolic Maturation Strategy (Broad)": 17,
                        "Metabolic Maturation Strategy": 20,
                        "Purification Strategy": 5,
                        "Purification Duration": 9,
                        "2D % Confluency": 8,
                        "2D Surface": 9,
                        "Ancestry of hiPSC Lines": 4,
                        "Sex of hiPSC Lines": 4
                    },
                    "Decisions for Functional Maturation and Disease Modelling": {
                        "hiPSC-CM Maintenance/Maturation Media (if different)": 6,
                        "hiPSC-CM Media Supplement": 20,
                        "hiPSC-CM Matrix Coating if Replated": 8,
                        "Disease Modelling": 14,
                        "Pharmacological Interventions": 19
                    },
                    "Variables in 3D Tissue Engineering and Complex Systems": {
                        "3D Platform": 11,
                        "3D % Confluency": 8,
                        "3D Cell Types": 5,
                        "3D EC % Composition": 3,
                        "3D Endothelial Cell Type": 5,
                        "3D SC % Composition": 3,
                        "3D Stromal Cell Type": 10,
                        "3D CM % Composition": 3,
                        "3D Estimated Tissue Cell Density": 4,
                        "3D Estimated Tissue Size": 5,
                        "3D Tissue Media": 12
                    },
                    "Functional Parameters": {
                        "Amplitude (F/F0)": 6,
                        "Beat Rate (beats per minute)": 6,
                        "Force (mN)": 6,
                        "Sarcomere Length (um)": 4,
                        "Upstroke Velocity (um/s)": 6,
                        "AP Amplitude (mV)": 6,
                        "AP Conduction Velocity (cm/s)": 6,
                        "Conduction Velocity (cm/s)": 4,
                        "Resting Membrane Potential (mV)": 6,
                        "Time to Peak (ms)": 6,
                        "Time to Relaxation (ms)": 4,
                        "Stress (mN/mm2)": 6,
                        "Max Capture Rate (Hz)": 4
                    },
                    "Analytical Methods": {
                        "Calcium Handling Analysis Method": 4,
                        "Metabolic Analysis Method": 5,
                        "Contractile Analysis Method": 6,
                        "Electrophysiology Analysis Method": 6,
                        "Gene Analysis Method": 4,
                        "Differentiation Purity %": 9,
                        "Differentiation Purity Assessment": 10,
                        "Visual Analysis": 4,
                        "Sarcomere/Cellular Alignment Analysis": 1
                    }
                };

                let currentHeaderIndex = 1;  /// Skip Study
                let formHTML = '';

                // Iterate through each top-level section in sectionDict
                Object.keys(sectionDict).forEach(category => {
                    formHTML += `
                        <div class="well">
                            <h3>
                                <a data-toggle="collapse" href="#collapse-${category.replace(/\s+/g, '')}" aria-expanded="false" aria-controls="collapse-${category.replace(/\s+/g, '')}">
                                    <strong>${category}</strong>
                                </a>
                            </h3>
                            <div id="collapse-${category.replace(/\s+/g, '')}" class="collapse">
                    `;

                    // For each item in the current category, generate the collapsible sections and form inputs
                    const items = sectionDict[category];
                    Object.keys(items).forEach(item => {
                        const itemCount = items[item];

                        // Create the collapsible section with a button and a hidden div
                        formHTML += `
                            <div class="section">
                                <button type="button" class="collapsible" onclick="toggleSection('${item.replace(/\s+/g, '')}')">${item}</button>
                                <div id="${item.replace(/\s+/g, '')}" class="content" style="display:none;">
                        `;

                        // Add the form inputs under this collapsible section
                        for (let i = 0; i < itemCount; i++) {
                            const header = headers[currentHeaderIndex];
                            formHTML += `
                                <div class="form-group" style="display: block; margin-bottom: 5px;">
                                    <label>${header}:</label>
                                    <label for="${header}Yes" style="margin-left:20px;">Yes</label>
                                    <input type="checkbox" id="${header}Yes" name="${header}" value="True" onchange="ensureExclusive('${header}', 'Yes')">
                                    <label for="${header}No" style="margin-left:10px;">No</label>
                                    <input type="checkbox" id="${header}No" name="${header}" value="False" onchange="ensureExclusive('${header}', 'No')">
                                </div>
                            `;
                            currentHeaderIndex++;
                        }

                        // Close the collapsible section div
                        formHTML += `
                                </div> <!-- End of content for item -->
                            </div> <!-- End of section for item -->
                        `;
                    });

                    formHTML += `
                            </div> <!-- End of collapse for category -->
                        </div> <!-- End of well for category -->
                    `;
                });

                document.getElementById('formInputs').innerHTML = formHTML;
            }


            function ensureExclusive(header, selectedValue) {
                const yesCheckbox = document.getElementById(`${header}Yes`);
                const noCheckbox = document.getElementById(`${header}No`);

                if (selectedValue === 'Yes' && yesCheckbox.checked) {
                    noCheckbox.checked = false; // Uncheck No if Yes is selected
                } else if (selectedValue === 'No' && noCheckbox.checked) {
                    yesCheckbox.checked = false; // Uncheck Yes if No is selected
                }
            }

            function toggleSection(sectionId) {
                const content = document.getElementById(sectionId);
                if (content.style.display === "none") {
                    content.style.display = "block";
                } else {
                    content.style.display = "none";
                }
            }


            // Function to calculate similarity between rows
            function calculateSimilarity(row1, row2) {
                let matchCount = 0;
                for (let i = 0; i < row1.length; i++) {
                    if (row1[i] === row2[i] && row1[i] !== 'NaN') {
                        matchCount++;
                    }
                }
                return matchCount;
            }

            document.getElementById('newRowForm').addEventListener('submit', function(event) {
                event.preventDefault(); 

                const newRow = ['Your Input'];  // To fill in the Study column
                const headers = tsvData[0].filter(header => header !== 'Similarity' && header !== 'Study'); // Exclude "Similarity" and "Study" from headers

                headers.forEach(header => {
                    const yesSelected = document.getElementById(`${header}Yes`).checked;
                    const noSelected = document.getElementById(`${header}No`).checked;

                    if (yesSelected) {
                        newRow.push('True');
                    } else if (noSelected) {
                        newRow.push('False');
                    } else {
                        newRow.push('NaN');
                    }
                });

                newRow.push((MaxSimilarity + 1).toString()); // Update the similarity index

                tsvData.push(newRow); // Add new row to data

                // Update similarities and refresh data table
                tsvData.slice(1).forEach(row => {
                    const similarity = calculateSimilarity(row, newRow);
                    row[row.length - 1] = similarity.toString();
                });

                MaxSimilarity++;

                $('#tsvTable').DataTable().destroy();
                constructDataTable(tsvData);
                
                this.reset(); // Reset the form after submission
            });
            
            function constructDataTable(data) {
                generateFormInputs(data[0]); // Generate form inputs excluding "Similarity"

                const tableHTML = `
                    <table id="tsvTable" class="display" style="width:100%">
                        <thead>
                            <tr>${data[0].map(header => `<th>${header}</th>`).join('')}</tr>
                        </thead>
                        <tbody>
                            ${data.slice(1).map(row => 
                                `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`
                            ).join('')}
                        </tbody>
                    </table>
                `;

                document.getElementById('tsv-data').innerHTML = tableHTML;

                $(document).ready(function() {
                    $('#tsvTable').DataTable({
                        "scrollX": true,
                        "pageLength": 5,
                        "autoWidth": false,
                        "dom": "Bfrtip",
                        "columnDefs": [
                            { "visible": false, "targets": Array.from({length: data[0].length}, (v, i) => i).filter(index => ![0, 283, 288, 306, 312, 322, 326, 332, 338, 344, 348, 354, 360, 364, 370, 374].includes(index)) }
                        ],
                        "order": [[data[0].length - 1, 'desc']], // Sort by the "Similarity" column (ascending order)
                        "buttons": [
                            {
                                "extend": "colvis",
                                "className": "btn btn-primary",
                                "text": "Select Protocol Features"
                            }
                        ]
                    });
                });
            }

            loadTSV();
        </script>

        <div class="well">
            <h3>Would you like to contribute your protocol design to the database?</h3>
            
            <!-- Publication DOI link input -->
            <div class="form-group">
                <label for="publicationDOI">Publication DOI Link (if any):</label>
                <input type="text" id="publicationDOI" name="publicationDOI" class="form-control" placeholder="https://"
                    style="background-color: transparent; color: black;">
            </div> <!-- form-group -->

            <!-- Contact info input -->
            <div class="form-group">
                <label for="contactInfo">Your Contact:</label>
                <input type="text" id="contactInfo" name="contactInfo" class="form-control" placeholder="Name, Email"
                    style="background-color: transparent; color: black;">
            </div> <!-- form-group -->

            <!-- Submit button -->
            <button type="button" class="btn btn-primary" onclick="showPopup()">Submit</button>
        </div> <!-- well -->

        <script>
            function showPopup() {
                alert('Pending on Reviewer Feedback and Technical Feasibility');
            }
        </script>
    
    </div> <!-- container-fluid main-container -->


  </body>
</html>
